<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Note & Maps - Cao Th√†nh T√¢n</title>
    <link rel="icon" href="avatar.jpg" type="image/jpeg">
    <style>
        :root {
            --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21;
            --accent: #007bff; --note-bg: #fff9c4; --shadow: rgba(0,0,0,0.1);
        }
        /* Dark Mode */
        .dark-mode {
            --bg: #18191a; --card: #242526; --text: #e4e6eb;
            --accent: #2e89ff; --note-bg: #3a3b3c; --shadow: rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 20px; transition: 0.3s;
        }

        /* B·ªê C·ª§C 2 C·ªòT */
        .main-layout {
            display: flex;
            flex-direction: row;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            height: 92vh;
        }

        /* B·∫¢N ƒê·ªí */
        #map {
            flex: 0.8; 
            border-radius: 15px;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 15px var(--shadow);
        }

        /* GHI CH√ö  */
        .container {
            flex: 1.2;
            background: var(--card);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            text-align: center;
            overflow-y: auto;
        }

        /* STYLE CHO N√öT GPS */
        .gps-button {
            background-color: #fff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
            width: 45px; height: 45px;
            margin: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; transition: 0.3s;
        }
        .gps-button:hover { background-color: #f0f0f0; transform: scale(1.1); }

        .avatar { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--accent); object-fit: cover; margin-bottom: 15px; }
        h1 { font-size: 22px; margin: 0; text-transform: uppercase; }
        .mssv { color: var(--accent); font-weight: bold; margin-bottom: 20px; font-size: 14px; }

        .input-group { display: flex; gap: 10px; margin-bottom: 25px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: var(--card); color: var(--text); outline: none; }
        button#addBtn { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        ul { list-style: none; padding: 0; text-align: left; }
        li { 
            background: var(--note-bg); color: #333; padding: 15px; 
            margin-bottom: 12px; border-radius: 8px; display: flex; 
            justify-content: space-between; align-items: center;
            border-left: 6px solid #f1c40f; font-weight: 500;
        }
        .del-btn { background: #ff4757; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }

        @media (max-width: 1000px) {
            .main-layout { flex-direction: column; height: auto; }
            #map { height: 350px; width: 100%; }
            .container { width: 100%; box-sizing: border-box; }
        }
    </style>
</head>
<body class="dark-mode">

    <div class="main-layout">
        <div id="map"></div>

        <div class="container">
            <img src="avatar.jpg" alt="Avatar" class="avatar">
            <h1>CAO TH√ÄNH T√ÇN</h1>
            <div class="mssv">MSSV: 29211345079</div>

            <div class="input-group">
                <input type="text" id="noteInput" placeholder="Nh·∫≠p ghi ch√∫ m·ªõi...">
                <button id="addBtn" onclick="addNote()">Th√™m</button>
            </div>
            <ul id="noteList"></ul>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDmqg2985OqlWyyusRhwYuRv6CtVVYjl_0",
            authDomain: "notewebctt.firebaseapp.com",
            projectId: "notewebctt",
            storageBucket: "notewebctt.firebasestorage.app",
            messagingSenderId: "121584329654",
            appId: "1:121584329654:web:3d41d1b2b89dbac4175717",
            measurementId: "G-00PYX7NE0X"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const notesCol = collection(db, "notes_cua_tan");

        onSnapshot(query(notesCol, orderBy("createdAt", "desc")), (snapshot) => {
            const list = document.getElementById('noteList');
            list.innerHTML = "";
            snapshot.forEach((doc) => {
                const note = doc.data();
                const li = document.createElement('li');
                li.innerHTML = `<span>${note.text}</span><button class="del-btn" onclick="deleteNote('${doc.id}')">X√≥a</button>`;
                list.appendChild(li);
            });
        });

        window.addNote = async function() {
            const input = document.getElementById('noteInput');
            if (!input.value.trim()) return;
            await addDoc(notesCol, { text: input.value, createdAt: serverTimestamp() });
            input.value = "";
        };

        window.deleteNote = async function(id) { await deleteDoc(doc(db, "notes_cua_tan", id)); };
    </script>

    <script>
        function initMap() {
            let userPos = { lat: 16.0544, lng: 108.2022 }; // ƒê√† N·∫µng
            
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: userPos,
                mapTypeControl: false,
                fullscreenControl: false,
                styles: [
                    {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                    {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                    {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]}
                ]
            });

            const marker = new google.maps.Marker({
                position: userPos,
                map: map,
                title: "V·ªã tr√≠ c·ªßa b·∫°n",
                animation: google.maps.Animation.DROP
            });

            // T·∫†O N√öT GPS QUAY V·ªÄ V·ªä TR√ç
            const locationButton = document.createElement("button");
            locationButton.innerHTML = "üéØ";
            locationButton.classList.add("gps-button");
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(locationButton);

            locationButton.addEventListener("click", () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        marker.setPosition(pos);
                        map.setCenter(pos);
                        map.setZoom(17);
                    });
                }
            });

            // T·ª± ƒë·ªông l·∫•y v·ªã tr√≠ khi kh·ªüi ƒë·ªông
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((p) => {
                    const currentPos = { lat: p.coords.latitude, lng: p.coords.longitude };
                    marker.setPosition(currentPos);
                    map.setCenter(currentPos);
                });
            }
        }
    </script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCy4yXSLr85mw0RFcQHMpFy3fwcSqd5P3E&callback=initMap"></script>

</body>
</html>